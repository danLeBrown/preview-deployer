# Example GitHub Actions workflow for preview deployments
# This is an alternative to webhooks - you can trigger deployments via GitHub Actions
# Note: This requires the orchestrator API to be accessible from GitHub Actions runners

name: Preview Deployment

on:
  pull_request:
    types: [opened, synchronize, closed]

jobs:
  deploy-preview:
    runs-on: ubuntu-latest
    if: github.event.action != 'closed'
    steps:
      - name: Trigger Preview Deployment
        run: |
          curl -X POST \
            -H "Content-Type: application/json" \
            -H "X-Hub-Signature-256: sha256=$(echo -n '${{ toJson(github.event) }}' | openssl dgst -sha256 -hmac "${{ secrets.PREVIEW_WEBHOOK_SECRET }}" | cut -d' ' -f2)" \
            ${{ secrets.PREVIEW_ORCHESTRATOR_URL }}/webhook/github \
            -d '${{ toJson(github.event) }}'

  cleanup-preview:
    runs-on: ubuntu-latest
    if: github.event.action == 'closed'
    steps:
      - name: Cleanup Preview Deployment
        run: |
          curl -X POST \
            -H "Content-Type: application/json" \
            -H "X-Hub-Signature-256: sha256=$(echo -n '${{ toJson(github.event) }}' | openssl dgst -sha256 -hmac "${{ secrets.PREVIEW_WEBHOOK_SECRET }}" | cut -d' ' -f2)" \
            ${{ secrets.PREVIEW_ORCHESTRATOR_URL }}/webhook/github \
            -d '${{ toJson(github.event) }}'
