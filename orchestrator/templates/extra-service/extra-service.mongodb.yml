# MongoDB extra service (database). Merged into compose when extra_services: [mongodb].
# App receives DATABASE_URL=mongodb://preview:preview@mongodb:27017/pr_{{prNumber}} and depends_on: mongodb.
image: mongo:7-alpine
container_name: {{projectSlug}}-pr-{{prNumber}}-mongodb
restart: unless-stopped
ports:
  - "{{exposedDbPort}}:27017"
environment:
  - MONGO_INITDB_ROOT_USERNAME=preview
  - MONGO_INITDB_ROOT_PASSWORD=preview
  - MONGO_INITDB_DATABASE=pr_{{prNumber}}
  - MONGO_HOST=localhost
  - MONGO_PORT=27017
healthcheck:
  test: ["CMD-SHELL", "mongo --eval 'db.runCommand({ ping: 1 })'"]
  interval: 10s
  timeout: 5s
  retries: 5
  start_period: 10s
deploy:
  resources:
    limits:
      cpus: '0.5'
      memory: 512M
    reservations:
      cpus: '0.1'
      memory: 256M
